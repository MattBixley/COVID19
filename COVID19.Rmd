---
title: "COVID19 - New Zealand"
author: "Matt Bixley"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    # social: ["facebook", "twitter", "linkedin"]
    source_code: embed
    vertical_layout: fill
---

```{r setup, include=FALSE}
#------------------ Packages ------------------
library(flexdashboard)
library(tidyverse)
library(lubridate)

#------------------ Parameters ------------------
# Set colors
# https://www.w3.org/TR/css-color-3/#svg-color
cases_color <- "black"
death_color <- "red"
#------------------ Data ------------------
source("code/import_data.R")
source("code/population.R")

coronavirus <- left_join(cases, deaths) %>% 
  mutate(state = ifelse(is.na(state), country, state)) %>% 
  mutate(state = ifelse(state == "Taiwan*", "Taiwan",state)) %>% 
  mutate(country = ifelse(country == "Taiwan*", "Taiwan",country)) %>%
  mutate(state = ifelse(state == "US", "United States",state)) %>%
  mutate(country = ifelse(country == "US", "United States",country))

coronavirus <- coronavirus %>% left_join(., world_pop, by = c("country", "country")) %>% 
  mutate(per_million = country_cum_cases/population * 1000000)

latest <- coronavirus %>% filter(Date == max(Date))
nz <- coronavirus %>% filter(country == "New Zealand")

coronavirus %>% filter(country == "Australia")
```

Summary
=======================================================================

Row {data-width=400}
-----------------------------------------------------------------------

### confirmed {.value-box}

```{r}

valueBox(
  value = paste(format(max(nz$cumulative_cases), big.mark = ","), "", sep = " "),
  caption = "Total confirmed cases",
  icon = "fas fa-user-md",
  color = confirmed_color
)
```


### active {.value-box}

```{r}
valueBox(
  value = paste(format(max(nz$cumulative_deaths), big.mark = ","), " (",
    round(100 * sum(df$unrecovered, na.rm = TRUE) / sum(df$confirmed), 1),
    "%)",
    sep = ""
  ),
  caption = "Active cases (% of total cases)", icon = "fas fa-ambulance",
  color = active_color
)
```

### death {.value-box}

```{r}

valueBox(
  value = paste(format(max(nz$cumulative_deaths), big.mark = ","), "", sep = " "),
  caption = "Death cases (death rate)",
  icon = "fas fa-heart-broken",
  color = death_color
)
```


Row
-----------------------------------------------------------------------

### **Daily cumulative cases by type** (New Zealand only)
    
```{r}

# plot nz growth
#who <- "New Zealand"
who <- c("New Zealand", "Australia", "United States", "Italy")

p1 <- coronavirus %>% filter(country == who, cumulative_cases > 100) %>%
  group_by(country) %>% 
  mutate(days100 = dense_rank(Date)) %>% 
  ungroup() %>% 
  #ggplot(aes(x = days100, y = per_million, colour = country)) +
  ggplot(aes(x = days100, y = country_cum_cases, colour = country)) +
  geom_point() +
  geom_line()
p1

p2 <- coronavirus %>% filter(country == who) %>% 
  ggplot(aes(x = Date, y = country_cases, fill = country)) +
  geom_bar(stat="identity", position = "dodge")
p2

```

Comparison
=======================================================================


Column {data-width=400}
-------------------------------------


### **Daily new cases**
    
```{r}

#----------------------------------------
# Plotting the data

p2
```
 
### **Cases distribution by type**

```{r daily_summary, eval = F}

```


Map
=======================================================================

### **World map of cases** (*use + and - icons to zoom in/out*)

```{r, eval = f}
# make a ma
library(leaflet)
library(leafpop)

map_object %>%
  addLayersControl(
    overlayGroups = names(cv_data_for_plot.split),
    options = layersControlOptions(collapsed = FALSE)
  )
```





About
=======================================================================

**The Coronavirus Dashboard: the case of New Zealand**

This Coronavirus dashboard: the case of New Zealand provides an overview of the 2019 Novel Coronavirus COVID-19 (2019-nCoV) epidemic for New Zealand. This dashboard is built with R using the R Makrdown framework and was adapted from this [dashboard](https://ramikrispin.github.io/coronavirus_dashboard/){target="_blank"} by Rami Krispin.

**Code**

The code behind this dashboard is available on [GitHub](https://github.com/AntoineSoetewey/coronavirus_dashboard){target="_blank"}.

**Data**

The input data for this dashboard is the dataset available from the [`{coronavirus}`](https://github.com/RamiKrispin/coronavirus){target="_blank"} R package. Make sure to download the development version of the package to have the latest data:

```
install.packages("devtools")
devtools::install_github("RamiKrispin/coronavirus")
```

The data and dashboard are refreshed on a daily basis.

The raw data is pulled from the Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE) Coronavirus [repository](https://github.com/RamiKrispin/coronavirus-csv){target="_blank"}.

**Contact**

For any question or feedback, you can [contact me](https://www.statsandr.com/contact/). More information about this dashboard can be found in this [article](https://www.statsandr.com/blog/how-to-create-a-simple-coronavirus-dashboard-specific-to-your-country-in-r/).

**Update**

The data is as of `r format(max(coronavirus$date), "%A %B %d, %Y")` and the dashboard has been updated on `r format(Sys.time(), "%A %B %d, %Y")`.



*Go back to [www.statsandr.com](https://www.statsandr.com/) (blog) or [www.antoinesoetewey.com](https://www.antoinesoetewey.com/) (personal website)*.